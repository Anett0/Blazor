@using Microsoft.AspNetCore.Mvc.Rendering
@using ProjectInit.Core.Entities
@model List<ProjectInit.Core.Entities.Hotel>

@{
    ViewData["Title"] = "PetStay: Онлайн-платформа для готелювання тварин";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetStay: Онлайн-платформа для готелювання тварин - Про нас</title>
</head>
<body class="bg-gray-100 h-screen">
    <header class="bg-orange-500 py-4">
        <h1 class="text-3xl font-bold text-black mx-4">@ViewData["Title"]</h1>
    </header>
    <main class="container mx-auto p-4 pt-6">
        <h2 class="text-2xl font-bold mb-4">Про нас</h2>
        <p class="text-lg mb-6">
            "PetStay" - це веб-платформа, яка спрощує процес знаходження та бронювання готелю для тварин. Наша мета - забезпечити власникам тварин можливість знайти надійні та комфортні місця для перебування своїх улюбленців під час їхньої відсутності.
        </p>

        <div class="py-2">
            <div id="map"></div>
            <div class="py-1 mt-2" >
                <button id="nearesthotel" class="btn btn-primary mr-2 rounded hover:bg-blue-600 bg-blue-500 px-2 py-1 text-white">Найближчий до вас готель!</button>
            </div>
            
        </div>
        <h3 class="text-xl font-bold mb-2">Основні можливості</h3>
        <ul class="list-none mb-6">
            <li class="mb-2">Пошук та бронювання</li>
            <li class="mb-2">Профілі готелів</li>
            <li class="mb-2">Наявність послуг</li>
            <li class="mb-2">Огляди та рейтинги</li>
            <li class="mb-2">Комунікація з готелем</li>
        </ul>
        <h3 class="text-xl font-bold mb-2">Цільова аудиторія</h3>
        <ul class="list-none mb-6">
            <li class="mb-2">Власники тварин</li>
            <li class="mb-2">Готелі для тварин</li>
            <li class="mb-2">Любителі тварин</li>
        </ul>
        <p class="text-lg mb-6">
            PetStay створений з метою забезпечення спокою та впевненості власників тварин під час їхньої відсутності, а також забезпечення комфортного та безпечного проживання для їхніх улюбленців.
        </p>
    </main>
    <footer class="bg-orange-500 py-4 text-white text-center">
        <p class="mb-0">
            Created by <a class="text-white hover:text-gray-200" href="https://github.com/oa-ek/csharpproject-tim0n-pumba">Анна Стерник, Максим Поліщук</a>
        </p>
    </footer>
</body>
<style>
    #map {
        border: 2px solid green;
        border-radius: 10px;
        box-shadow: 5px 5px 5px;
        height: 300px;
    }

</style>

@section Scripts {
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/leaflet/leaflet.min.js"></script>
    <script src="~/leaflet-locatecontrol/L.Control.Locate.min.js"></script>
    <link rel="stylesheet" href="~/leaflet-locatecontrol/L.Control.Locate.css" />
    <script src="~/Leaflet.EasyButton/easy-button.min.js"></script>
    <link href="~/leaflet/leaflet.min.css" rel="stylesheet" />
    <script>
        $(function () {
            var userMarker = null;
            var map = L.map('map').setView([50.421118919183115, 30.515624983236197], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Add a geolocation control
            var locateControl = L.control.locate({
                position: 'topleft',
                strings: {
                    title: "Show me where I am",
                    popup: "You are here",
                    outsideMapBoundsMsg: "You seem to be outside the map bounds, how about showing me where you are instead?"
                },
                locateOptions: {
                    enableHighAccuracy: true,
                    maximumAge: 10000,
                    timeout: 10000
                },
                onLocationError: function (e) {
                    alert(e.message);
                },
                onLocationOutsideMapBounds: function (e) {
                    map.fitWorld();
                }
            }).addTo(map);

            // Remove the marker when the user's location is lost
            map.on('locationerror', function () {
                if (userMarker) {
                    map.removeLayer(userMarker);
                    userMarker = null;
                }
            });

            // Remove the marker when the user turns off geolocation
            map.on('locationoff', function () {
                if (userMarker) {
                    map.removeLayer(userMarker);
                    userMarker = null;
                }
            });

            L.easyButton('fa-crosshairs fa-lg', function (btn, map) {
                // Check if geolocation is supported
                if (!navigator.geolocation) {
                    alert('Geolocation is not supported by your browser.');
                    return;
                }

                // Get the user's current location
                navigator.geolocation.getCurrentPosition(function (position) {
                    // Get the user's latitude and longitude
                    var userLatLng = [position.coords.latitude, position.coords.longitude];

                    // Create a LatLng object from the user's location
                    var userLocation = L.latLng(userLatLng);

                    // Find the nearest hotel to the user's location
                    var nearestHotel = null;
                    var nearestDistance = Infinity;

                    hotelMarkers.forEach(function (marker) {
                        var distance = userLocation.distanceTo(marker.getLatLng());
                        if (distance < nearestDistance) {
                            nearestHotel = marker;
                            nearestDistance = distance;
                        }
                    });

                    // Open the popup for the nearest hotel
                    if (map.hasLayer(nearestHotel)) {
                        nearestHotel.openPopup();
                    }
                }, function (error) {
                    console.log('Geolocation error:', error.message);
                    alert('Please enable geolocation to find the nearest hotel.');
                });
            }, {
                position: 'topleft',
                size: '30px',
                shape: 'square',
                backgroundColor: 'transparent',
                border: 'none'
                
            }).addTo(map);

            // Add hotel markers to the map
            var hotelMarkers = [];
        @foreach (var hotel in Model)
        {
            <text>
                    hotelMarkers.push(L.marker([@hotel.Latitude, @hotel.Longitude]).addTo(map).bindPopup('@hotel.Name <br> @hotel.Zipcode, @hotel.City, @hotel.Addres <br> <a href="/Hotel/View/@hotel.Id">Інформація про готель</a> '));
            </text>
        }
            


        });
    </script>
}